# 2025-12-08 - 일일 기록



## 주요 업무 및 작업
- PDF 내 벡터 이미지 검출 및 위치 추출
- PDF 이미지 편집 GUI 프로그램 개발
- 벡터 그래픽 렌더링 및 재삽입 로직 구현

## 배운 점 및 인사이트

### 문제: PDF 이미지가 검출되지 않음
- `page.get_images()` 메서드로 이미지를 찾으려 했으나 결과가 비어있음
- **원인**: PDF에 래스터 이미지(PNG, JPG)가 아닌 **벡터 그래픽**으로 라벨이 저장되어 있었음
- 벡터 그래픽은 이미지 파일이 아니라 **그리기 명령어의 집합**

### 해결: get_text("dict") 사용
- `get_text("dict")`의 `blocks` 중 `type=1`인 블록이 이미지/벡터 그래픽 영역
- 바운딩 박스 좌표를 얻을 수 있음
- 반환 형식: `bbox = (x0, y0, x1, y1)` 튜플

### 벡터 vs 래스터 차이점
- **래스터**: 이미지 파일이 PDF에 삽입됨, `get_images()`로 추출 가능
- **벡터**: PDF 내부에서 선/도형 명령어로 직접 그려짐, 메타데이터 거의 없음
- 벡터 그래픽의 실제 내용은 **렌더링**해야만 확인 가능

### 렌더링의 의미
- 크롭(자르기)이 아닌 **명령어 실행**을 통해 비트맵 이미지로 변환하는 과정
- 벡터 명령어들을 실행 → 픽셀 이미지 생성

### 이미지 수정이 어려운 이유
- 근본적 수정 = 벡터 명령어 자체를 수정해야 함
- 텍스트가 도형으로 아웃라인화 되어 있어 문자 단위 편집 불가능
- Python 라이브러리로는 저수준 벡터 명령어의 의미론적 편집이 매우 제한적
- **현실적 방법**: 원본 영역 렌더링 → 수정 → 흰색으로 덮기 → 새 이미지 삽입

### 참고 프로그램: Inkscape
- 무료 오픈소스 벡터 그래픽 편집기
- PDF를 열어 벡터 객체를 시각적으로 편집 가능
- 단, 아웃라인된 텍스트는 도형으로 인식되어 텍스트 편집 불가
- GUI 참고용으로 활용

## 문제 해결 및 코드 예시

### 벡터 이미지 검출 코드
```python
import fitz  # PyMuPDF

pdf_path = "your_file.pdf"
doc = fitz.open(pdf_path)
page = doc[0]

text_dict = page.get_text("dict")

for block in text_dict['blocks']:
    if block['type'] == 1:  # 1 = 이미지/벡터 그래픽 블록
        bbox = block['bbox']  # (x0, y0, x1, y1)
        print(f"벡터 그래픽 발견:")
        print(f"  좌표: x0={bbox[0]}, y0={bbox[1]}, x1={bbox[2]}, y1={bbox[3]}")
        print(f"  크기: {bbox[2]-bbox[0]} x {bbox[3]-bbox[1]}")
```

### 벡터 영역 렌더링 코드
```python
from PIL import Image

# 벡터 영역을 비트맵 이미지로 렌더링
bbox = (x0, y0, x1, y1)
scale = 5  # 5배 고해상도
pix = page.get_pixmap(clip=fitz.Rect(bbox), matrix=fitz.Matrix(scale, scale))
img = Image.frombytes("RGB", [pix.width, pix.height], pix.samples)
img.save("rendered_label.png")
```

### GUI 프로그램 구현
**기능:**
- PDF 로드 및 벡터 이미지 블록 자동 검출
- 빨간 테두리 + 반투명 빨강(80%) 오버레이로 시각화
- 마우스 드래그로 이미지 위치 이동
- 모서리/변 핸들로 크기 및 비율 조정
- 원본 bbox 저장 → 렌더링 → 리사이즈 → 새 위치 삽입
- 변경사항 PDF로 저장

**핵심 로직:**
1. 원본 위치(`original_bbox`)에서 이미지 렌더링
2. 새 크기에 맞춰 리사이즈 (비율 변경 적용)
3. 원본 영역 흰색으로 덮기
4. 새 위치(`bbox`)에 리사이즈된 이미지 삽입

**사용 기술:** PyQt5, PyMuPDF, Pillow

##  내일 할 일
- 이미지 내용 수정 방식 고안
- 원격탐지 관련 이미지패치 부분 최적화
- 3d 랜드마크 gt 레이블링 값 수정
